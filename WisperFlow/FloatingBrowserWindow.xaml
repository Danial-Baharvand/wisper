<Window x:Class="WisperFlow.FloatingBrowserWindow"
        xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
        xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
        xmlns:wv2="clr-namespace:Microsoft.Web.WebView2.Wpf;assembly=Microsoft.Web.WebView2.Wpf"
        Title="WisperFlow Browser"
        Width="600" Height="700"
        MinWidth="400" MinHeight="400"
        WindowStyle="None"
        AllowsTransparency="True"
        Background="Transparent"
        Topmost="True"
        ShowInTaskbar="False"
        ResizeMode="CanResizeWithGrip"
        WindowStartupLocation="Manual">
    
    <Window.Resources>
        <!-- Fade in animation -->
        <Storyboard x:Key="FadeInAnimation">
            <DoubleAnimation Storyboard.TargetProperty="Opacity"
                           From="0" To="1" Duration="0:0:0.25">
                <DoubleAnimation.EasingFunction>
                    <CubicEase EasingMode="EaseOut"/>
                </DoubleAnimation.EasingFunction>
            </DoubleAnimation>
            <DoubleAnimation Storyboard.TargetName="ContentTransform" Storyboard.TargetProperty="Y"
                           From="20" To="0" Duration="0:0:0.3">
                <DoubleAnimation.EasingFunction>
                    <CubicEase EasingMode="EaseOut"/>
                </DoubleAnimation.EasingFunction>
            </DoubleAnimation>
        </Storyboard>
        
        <!-- Fade out animation -->
        <Storyboard x:Key="FadeOutAnimation">
            <DoubleAnimation Storyboard.TargetProperty="Opacity"
                           To="0" Duration="0:0:0.2">
                <DoubleAnimation.EasingFunction>
                    <CubicEase EasingMode="EaseIn"/>
                </DoubleAnimation.EasingFunction>
            </DoubleAnimation>
            <DoubleAnimation Storyboard.TargetName="ContentTransform" Storyboard.TargetProperty="Y"
                           To="20" Duration="0:0:0.2">
                <DoubleAnimation.EasingFunction>
                    <CubicEase EasingMode="EaseIn"/>
                </DoubleAnimation.EasingFunction>
            </DoubleAnimation>
        </Storyboard>
        
        <!-- Button hover style -->
        <Style x:Key="ControlButtonStyle" TargetType="Button">
            <Setter Property="Background" Value="Transparent"/>
            <Setter Property="Foreground" Value="#8892b0"/>
            <Setter Property="BorderThickness" Value="0"/>
            <Setter Property="Padding" Value="8,4"/>
            <Setter Property="Cursor" Value="Hand"/>
            <Setter Property="Template">
                <Setter.Value>
                    <ControlTemplate TargetType="Button">
                        <Border x:Name="border" Background="{TemplateBinding Background}" 
                                CornerRadius="4" Padding="{TemplateBinding Padding}">
                            <ContentPresenter HorizontalAlignment="Center" VerticalAlignment="Center"/>
                        </Border>
                        <ControlTemplate.Triggers>
                            <Trigger Property="IsMouseOver" Value="True">
                                <Setter TargetName="border" Property="Background" Value="#2a2a3e"/>
                            </Trigger>
                            <Trigger Property="IsPressed" Value="True">
                                <Setter TargetName="border" Property="Background" Value="#3a3a4e"/>
                            </Trigger>
                        </ControlTemplate.Triggers>
                    </ControlTemplate>
                </Setter.Value>
            </Setter>
        </Style>
    </Window.Resources>
    
    <!-- Main container with rounded corners -->
    <Border x:Name="MainBorder" 
            Background="#F8121820" 
            CornerRadius="12" 
            BorderBrush="#2a2a3e"
            BorderThickness="1"
            ClipToBounds="True">
        <Border.RenderTransform>
            <TranslateTransform x:Name="ContentTransform" Y="0"/>
        </Border.RenderTransform>
        <Border.Effect>
            <DropShadowEffect Color="Black" BlurRadius="20" Opacity="0.5" ShadowDepth="2"/>
        </Border.Effect>
        
        <Grid>
            <Grid.RowDefinitions>
                <RowDefinition Height="40"/>
                <RowDefinition Height="*"/>
            </Grid.RowDefinitions>
            
            <!-- Top control strip (draggable) -->
            <Border Grid.Row="0" Background="#1a1a2e" CornerRadius="12,12,0,0"
                    MouseLeftButtonDown="TitleBar_MouseLeftButtonDown">
                <Grid>
                    <Grid.ColumnDefinitions>
                        <ColumnDefinition Width="Auto"/>
                        <ColumnDefinition Width="*"/>
                        <ColumnDefinition Width="Auto"/>
                    </Grid.ColumnDefinitions>
                    
                    <!-- Provider label with icon -->
                    <StackPanel Grid.Column="0" Orientation="Horizontal" VerticalAlignment="Center" Margin="12,0">
                        <Ellipse x:Name="ProviderIcon" Width="20" Height="20" Margin="0,0,8,0">
                            <Ellipse.Fill>
                                <LinearGradientBrush StartPoint="0,0" EndPoint="1,1">
                                    <GradientStop Color="#10a37f" Offset="0"/>
                                    <GradientStop Color="#1a7f5a" Offset="1"/>
                                </LinearGradientBrush>
                            </Ellipse.Fill>
                        </Ellipse>
                        <TextBlock x:Name="ProviderLabel" 
                                   Text="ChatGPT" 
                                   Foreground="#e6e6e6" 
                                   FontFamily="Segoe UI Semibold" 
                                   FontSize="13"
                                   VerticalAlignment="Center"/>
                    </StackPanel>
                    
                    <!-- Loading indicator -->
                    <StackPanel Grid.Column="1" Orientation="Horizontal" HorizontalAlignment="Center" VerticalAlignment="Center">
                        <TextBlock x:Name="LoadingText" 
                                   Text="Loading..." 
                                   Foreground="#6b7280" 
                                   FontFamily="Segoe UI" 
                                   FontSize="11"
                                   Visibility="Collapsed"/>
                    </StackPanel>
                    
                    <!-- Control buttons -->
                    <StackPanel Grid.Column="2" Orientation="Horizontal" VerticalAlignment="Center" Margin="0,0,8,0">
                        <!-- Separator -->
                        <Border Width="1" Height="16" Background="#3a3a4e" Margin="4,0" VerticalAlignment="Center"/>

                        <!-- Open in browser button -->
                        <Button x:Name="OpenExternalButton"
                                Style="{StaticResource ControlButtonStyle}"
                                ToolTip="Open in default browser"
                                Click="OpenExternalButton_Click">
                            <TextBlock Text="↗" FontSize="14" Foreground="#8892b0"/>
                        </Button>

                        <!-- Switch account button -->
                        <Button x:Name="SwitchAccountButton"
                                Style="{StaticResource ControlButtonStyle}"
                                ToolTip="Switch account (sign out)"
                                Click="SwitchAccountButton_Click">
                            <TextBlock Text="⟳" FontSize="14" Foreground="#8892b0"/>
                        </Button>

                        <!-- Close button -->
                        <Button x:Name="CloseButton"
                                Style="{StaticResource ControlButtonStyle}"
                                ToolTip="Close"
                                Click="CloseButton_Click">
                            <TextBlock Text="✕" FontSize="12" Foreground="#8892b0"/>
                        </Button>
                    </StackPanel>
                </Grid>
            </Border>
            
            <!-- WebView2 browsers - one per provider for instant switching -->
            <Border Grid.Row="1" CornerRadius="0,0,12,12" ClipToBounds="True">
                <Grid>
                    <!-- ChatGPT WebView -->
                    <wv2:WebView2 x:Name="ChatGPTWebView"
                                  DefaultBackgroundColor="Transparent"
                                  Visibility="Visible"/>
                    <!-- Gemini WebView -->
                    <wv2:WebView2 x:Name="GeminiWebView"
                                  DefaultBackgroundColor="Transparent"
                                  Visibility="Collapsed"/>
                </Grid>
            </Border>

            <!-- Resize grip visual -->
            <Path Grid.Row="1"
                  Data="M 0,12 L 12,0 M 4,12 L 12,4 M 8,12 L 12,8"
                  Stroke="#3a3a4e"
                  StrokeThickness="1"
                  HorizontalAlignment="Right"
                  VerticalAlignment="Bottom"
                  Margin="0,0,4,4"
                  IsHitTestVisible="False"/>
        </Grid>
    </Border>
</Window>
