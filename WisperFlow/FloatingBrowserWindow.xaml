<Window x:Class="WisperFlow.FloatingBrowserWindow"
        xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
        xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
        xmlns:wv2="clr-namespace:Microsoft.Web.WebView2.Wpf;assembly=Microsoft.Web.WebView2.Wpf"
        Title="WisperFlow Browser"
        Width="600" Height="700"
        MinWidth="400" MinHeight="400"
        WindowStyle="None"
        AllowsTransparency="True"
        Background="Transparent"
        Topmost="True"
        ShowInTaskbar="False"
        ResizeMode="NoResize"
        WindowStartupLocation="Manual">
    
    <Window.Resources>
        <!-- Fade in animation -->
        <Storyboard x:Key="FadeInAnimation">
            <DoubleAnimation Storyboard.TargetProperty="Opacity"
                           From="0" To="1" Duration="0:0:0.25">
                <DoubleAnimation.EasingFunction>
                    <CubicEase EasingMode="EaseOut"/>
                </DoubleAnimation.EasingFunction>
            </DoubleAnimation>
            <DoubleAnimation Storyboard.TargetName="ContentTransform" Storyboard.TargetProperty="Y"
                           From="20" To="0" Duration="0:0:0.3">
                <DoubleAnimation.EasingFunction>
                    <CubicEase EasingMode="EaseOut"/>
                </DoubleAnimation.EasingFunction>
            </DoubleAnimation>
        </Storyboard>
        
        <!-- Fade out animation -->
        <Storyboard x:Key="FadeOutAnimation">
            <DoubleAnimation Storyboard.TargetProperty="Opacity"
                           To="0" Duration="0:0:0.2">
                <DoubleAnimation.EasingFunction>
                    <CubicEase EasingMode="EaseIn"/>
                </DoubleAnimation.EasingFunction>
            </DoubleAnimation>
            <DoubleAnimation Storyboard.TargetName="ContentTransform" Storyboard.TargetProperty="Y"
                           To="20" Duration="0:0:0.2">
                <DoubleAnimation.EasingFunction>
                    <CubicEase EasingMode="EaseIn"/>
                </DoubleAnimation.EasingFunction>
            </DoubleAnimation>
        </Storyboard>
        
        <!-- Button hover style -->
        <Style x:Key="ControlButtonStyle" TargetType="Button">
            <Setter Property="Background" Value="Transparent"/>
            <Setter Property="Foreground" Value="#8892b0"/>
            <Setter Property="BorderThickness" Value="0"/>
            <Setter Property="Padding" Value="8,4"/>
            <Setter Property="Cursor" Value="Hand"/>
            <Setter Property="Template">
                <Setter.Value>
                    <ControlTemplate TargetType="Button">
                        <Border x:Name="border" Background="{TemplateBinding Background}" 
                                CornerRadius="4" Padding="{TemplateBinding Padding}">
                            <ContentPresenter HorizontalAlignment="Center" VerticalAlignment="Center"/>
                        </Border>
                        <ControlTemplate.Triggers>
                            <Trigger Property="IsMouseOver" Value="True">
                                <Setter TargetName="border" Property="Background" Value="#2a2a3e"/>
                            </Trigger>
                            <Trigger Property="IsPressed" Value="True">
                                <Setter TargetName="border" Property="Background" Value="#3a3a4e"/>
                            </Trigger>
                        </ControlTemplate.Triggers>
                    </ControlTemplate>
                </Setter.Value>
            </Setter>
        </Style>
    </Window.Resources>
    
    <!-- Main container with rounded corners -->
    <Grid>
        <Border x:Name="MainBorder" 
                Background="#F8121820" 
                CornerRadius="16" 
                BorderBrush="#2a2a3e"
                BorderThickness="1"
                ClipToBounds="True">
            <Border.RenderTransform>
                <TranslateTransform x:Name="ContentTransform" Y="0"/>
            </Border.RenderTransform>
            <Border.Effect>
                <DropShadowEffect Color="Black" BlurRadius="20" Opacity="0.5" ShadowDepth="2"/>
            </Border.Effect>
            
            <Grid>
                <Grid.RowDefinitions>
                    <RowDefinition Height="40"/>
                    <RowDefinition Height="*"/>
                </Grid.RowDefinitions>
                
                <!-- Top control strip (draggable) -->
                <Border Grid.Row="0" Background="#1a1a2e" CornerRadius="16,16,0,0"
                        MouseLeftButtonDown="TitleBar_MouseLeftButtonDown">
                    <Grid>
                        <Grid.ColumnDefinitions>
                            <ColumnDefinition Width="Auto"/>
                            <ColumnDefinition Width="*"/>
                            <ColumnDefinition Width="Auto"/>
                        </Grid.ColumnDefinitions>
                        
                        <!-- Provider label with icon -->
                        <StackPanel Grid.Column="0" Orientation="Horizontal" VerticalAlignment="Center" Margin="12,0">
                            <Ellipse x:Name="ProviderIcon" Width="20" Height="20" Margin="0,0,8,0">
                                <Ellipse.Fill>
                                    <LinearGradientBrush StartPoint="0,0" EndPoint="1,1">
                                        <GradientStop Color="#10a37f" Offset="0"/>
                                        <GradientStop Color="#1a7f5a" Offset="1"/>
                                    </LinearGradientBrush>
                                </Ellipse.Fill>
                            </Ellipse>
                            <TextBlock x:Name="ProviderLabel" 
                                       Text="ChatGPT" 
                                       Foreground="#e6e6e6" 
                                       FontFamily="Segoe UI Semibold" 
                                       FontSize="13"
                                       VerticalAlignment="Center"/>
                        </StackPanel>
                        
                        <!-- Address Bar and Refresh -->
                        <Grid Grid.Column="1" Margin="8,4" VerticalAlignment="Center">
                            <Grid.ColumnDefinitions>
                                <ColumnDefinition Width="*"/>
                                <ColumnDefinition Width="Auto"/>
                            </Grid.ColumnDefinitions>
                            
                            <Border Grid.Column="0" Background="#0CFFFFFF" CornerRadius="6" BorderBrush="#1FFFFFFF" BorderThickness="1" Margin="0,0,4,0">
                                <TextBox x:Name="UrlTextBox"
                                         Text=""
                                         Foreground="#9ca3af"
                                         Background="Transparent"
                                         BorderThickness="0"
                                         Padding="8,3"
                                         FontSize="11"
                                         FontFamily="Consolas"
                                         VerticalContentAlignment="Center"
                                         IsReadOnly="True"
                                         Cursor="Arrow"/>
                            </Border>

                            <Button Grid.Column="1" Style="{StaticResource ControlButtonStyle}" Click="RefreshButton_Click" ToolTip="Reload Page">
                                <TextBlock Text="&#xE72C;" FontFamily="Segoe MDL2 Assets" FontSize="12"/>
                            </Button>
                        </Grid>
                        
                        <!-- Control buttons -->
                        <StackPanel Grid.Column="2" Orientation="Horizontal" VerticalAlignment="Center" Margin="0,0,8,0">
                            <!-- Separator -->
                            <Border Width="1" Height="16" Background="#3a3a4e" Margin="4,0" VerticalAlignment="Center"/>

                            <!-- Open in browser button -->
                            <Button x:Name="OpenExternalButton"
                                    Style="{StaticResource ControlButtonStyle}"
                                    ToolTip="Open in default browser"
                                    Click="OpenExternalButton_Click">
                                <TextBlock Text="↗" FontSize="14" Foreground="#8892b0"/>
                            </Button>

                            <!-- Switch account button -->
                            <Button x:Name="SwitchAccountButton"
                                    Style="{StaticResource ControlButtonStyle}"
                                    ToolTip="Switch account (sign out)"
                                    Click="SwitchAccountButton_Click">
                                <TextBlock Text="⟳" FontSize="14" Foreground="#8892b0"/>
                            </Button>

                            <!-- Close button -->
                            <Button x:Name="CloseButton"
                                    Style="{StaticResource ControlButtonStyle}"
                                    ToolTip="Close"
                                    Click="CloseButton_Click">
                                <TextBlock Text="✕" FontSize="12" Foreground="#8892b0"/>
                            </Button>
                        </StackPanel>
                    </Grid>
                </Border>
                
                <!-- WebView2 browsers -->
                <Border Grid.Row="1" x:Name="WebViewBorder" ClipToBounds="True">
                    <Grid x:Name="WebViewContainer">
                        <!-- ChatGPT WebView -->
                        <wv2:WebView2 x:Name="ChatGPTWebView"
                                      DefaultBackgroundColor="Transparent"
                                      Visibility="Visible"/>
                        <!-- Gemini WebView -->
                        <wv2:WebView2 x:Name="GeminiWebView"
                                      DefaultBackgroundColor="Transparent"
                                      Visibility="Collapsed"/>
                        <!-- Notion WebView -->
                        <wv2:WebView2 x:Name="NotionWebView"
                                      DefaultBackgroundColor="Transparent"
                                      Visibility="Collapsed"/>
                        <!-- Google Tasks WebView -->
                        <wv2:WebView2 x:Name="GoogleTasksWebView"
                                      DefaultBackgroundColor="Transparent"
                                      Visibility="Collapsed"/>
                        
                        <!-- Corner masks to create rounded corner effect over WebView2 -->
                        <!-- Bottom-left corner mask -->
                        <Path HorizontalAlignment="Left" VerticalAlignment="Bottom"
                              Data="M 0,16 L 0,0 A 16,16 0 0,1 16,16 Z"
                              Fill="#121820" IsHitTestVisible="False"/>
                        <!-- Bottom-right corner mask -->
                        <Path HorizontalAlignment="Right" VerticalAlignment="Bottom"
                              Data="M 16,16 L 0,16 A 16,16 0 0,1 0,0 L 16,0 Z"
                              Fill="#121820" IsHitTestVisible="False"/>
                    </Grid>
                </Border>
            </Grid>
        </Border>
        
        <!-- Invisible resize handles on all corners -->
        <Rectangle x:Name="ResizeTopLeft" 
                   Width="16" Height="16" 
                   Fill="Transparent" 
                   Cursor="SizeNWSE"
                   HorizontalAlignment="Left" VerticalAlignment="Top"
                   MouseLeftButtonDown="ResizeHandle_MouseLeftButtonDown"/>
        <Rectangle x:Name="ResizeTopRight" 
                   Width="16" Height="16" 
                   Fill="Transparent" 
                   Cursor="SizeNESW"
                   HorizontalAlignment="Right" VerticalAlignment="Top"
                   MouseLeftButtonDown="ResizeHandle_MouseLeftButtonDown"/>
        <Rectangle x:Name="ResizeBottomLeft" 
                   Width="16" Height="16" 
                   Fill="Transparent" 
                   Cursor="SizeNESW"
                   HorizontalAlignment="Left" VerticalAlignment="Bottom"
                   MouseLeftButtonDown="ResizeHandle_MouseLeftButtonDown"/>
        <Rectangle x:Name="ResizeBottomRight" 
                   Width="16" Height="16" 
                   Fill="Transparent" 
                   Cursor="SizeNWSE"
                   HorizontalAlignment="Right" VerticalAlignment="Bottom"
                   MouseLeftButtonDown="ResizeHandle_MouseLeftButtonDown"/>
        
        <!-- Invisible resize handles on all sides -->
        <Rectangle x:Name="ResizeTop" 
                   Height="8" 
                   Fill="Transparent" 
                   Cursor="SizeNS"
                   HorizontalAlignment="Stretch" VerticalAlignment="Top"
                   Margin="16,0,16,0"
                   MouseLeftButtonDown="ResizeHandle_MouseLeftButtonDown"/>
        <Rectangle x:Name="ResizeBottom" 
                   Height="8" 
                   Fill="Transparent" 
                   Cursor="SizeNS"
                   HorizontalAlignment="Stretch" VerticalAlignment="Bottom"
                   Margin="16,0,16,0"
                   MouseLeftButtonDown="ResizeHandle_MouseLeftButtonDown"/>
        <Rectangle x:Name="ResizeLeft" 
                   Width="8" 
                   Fill="Transparent" 
                   Cursor="SizeWE"
                   HorizontalAlignment="Left" VerticalAlignment="Stretch"
                   Margin="0,16,0,16"
                   MouseLeftButtonDown="ResizeHandle_MouseLeftButtonDown"/>
        <Rectangle x:Name="ResizeRight" 
                   Width="8" 
                   Fill="Transparent" 
                   Cursor="SizeWE"
                   HorizontalAlignment="Right" VerticalAlignment="Stretch"
                   Margin="0,16,0,16"
                   MouseLeftButtonDown="ResizeHandle_MouseLeftButtonDown"/>
                   

    </Grid>
</Window>
